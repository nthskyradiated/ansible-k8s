---
- name: Wait for APT locks
  ansible.builtin.wait_for:
    path: "{{ item }}"
    state: absent
    timeout: 90  # 5 minutes timeout
    sleep: 5      # Check every 5 seconds
  loop:
    - /var/lib/dpkg/lock-frontend
    - /var/lib/apt/lists/lock
    - /var/lib/dpkg/lock
  become: true
  register: apt_wait